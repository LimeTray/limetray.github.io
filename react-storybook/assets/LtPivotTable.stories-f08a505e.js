import{j as t}from"./jsx-runtime-8406ef1e.js";import{r as Y,R as Fe}from"./index-ad58220e.js";import{L as Ee}from"./ltTable-a82ecb6b.js";import{L as Be}from"./ltButton-612ce8c0.js";import{L as Re}from"./ltCardV2-9251f780.js";import{S as ce}from"./stringConstants-f1def6f8.js";import{D as Je,C as ze,P as Xe}from"./react-beautiful-dnd.esm-970fb784.js";import{g as Qe}from"./requestIdGenerator-f6efc017.js";import{h as pe}from"./util-bfaa5c4b.js";import{D as et}from"./grippy-fc4fd531.js";import{I as tt}from"./Icon-370c2d23.js";import{I as nt}from"./Label-d5345000.js";import{L as st}from"./ltToggle-748b0678.js";import{L as Ne}from"./index-6dcb29cb.js";import"./_commonjsHelpers-de833af9.js";import"./extends-4c19d496.js";import"./map-20538cdf.js";import"./getElementType-ff0d42f5.js";import"./childrenUtils-dd3b0ba5.js";import"./factories-df82d7d3.js";import"./Button-21321eef.js";import"./inheritsLoose-5494d9cc.js";import"./Ref-51c42093.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./index-4fee7e45.js";import"./Header-30441d32.js";import"./Card-7a020250.js";import"./toPropertyKey-4015efc6.js";import"./tiny-invariant-dd7d57d2.js";import"./ModernAutoControlledComponent-6bbe7d3d.js";import"./assertThisInitialized-081f9914.js";import"./htmlPropsUtils-2b22d933.js";import"./includes-192f9362.js";import"./Portal-8d2f321a.js";import"./Checkbox-cb5dd6fb.js";import"./_baseSet-d58de3a8.js";const le=({label:i,active:a=!1,primary:r=!1,onClick:o,disabled:l=!1,className:P="",id:I,children:g})=>{const W=`pivot-button ${a?"pivot-button--active":""} ${P}`;return t.jsx(Be,{label:i,onClick:o,disabled:l,className:W,id:I,border:!0,size:"small",primary:r,children:g&&t.jsx("span",{className:"pivot-button__icon",children:g})})};le.__docgenInfo={description:"",methods:[],displayName:"PivotTableButton",props:{label:{required:!0,tsType:{name:"string"},description:""},active:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},primary:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onClick:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},disabled:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},className:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'""',computed:!1}},id:{required:!1,tsType:{name:"string"},description:""},children:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}};const at=(i,a)=>({userSelect:"none",background:i?"darkgrey":"white",...a}),rt=(i,a,r)=>{const o=Array.from(i),[l]=o.splice(a,1);return o.splice(r,0,l),o},it=i=>({background:i?"grey":"white"});class Se extends Y.Component{constructor(a){super(a),this.onDragEnd=r=>{if(!r.destination)return;const{dataList:o}=this.state,l=rt(o,r.source.index,r.destination.index);this.setState({dataList:l,selectedIndex:r.destination.index},()=>{const{onDragEnd:P,identifier:I}=this.props,g={oldIndex:r.source.index,newRank:r.destination.index,identifier:I};P&&P(g)})},this.renderChildrens=r=>{const{childrenItemElem:o,selectChild:l}=this.props;return t.jsx("div",{children:r.childrens.map((P,I)=>t.jsxs("div",{onClick:()=>{l(P)},tabIndex:I,onKeyDown:()=>{},role:"button",className:"d-l-sm-item-child flex align-center  bdr-btm-grey d-sm-children",children:[t.jsx("div",{children:P.childName}),t.jsx("div",{className:"flex-grow-1 justify-end flex",children:o(P)})]},Qe()))})},this.renderList=()=>{const{dataList:r,openedParent:o,selectedIndex:l}=this.state,{parentItemElem:P,selectParent:I}=this.props;return t.jsx("div",{children:t.jsx(Je,{onDragEnd:this.onDragEnd,children:t.jsx(ze,{droppableId:"droppable",children:(g,W)=>t.jsxs("div",{...g.droppableProps,ref:g.innerRef,style:it(W.isDraggingOver),children:[r.map((x,F)=>t.jsx(Xe,{draggableId:x.parentId,index:F,children:(y,_)=>t.jsxs("div",{onClick:()=>{this.setState({selectedIndex:F}),I(x)},tabIndex:F,role:"button",onKeyDown:()=>{},ref:y.innerRef,...y.draggableProps,...y.dragHandleProps,style:at(_.isDragging,y.draggableProps.style),children:[t.jsxs("div",{style:{borderLeft:l===F?"4px solid #0054ce":"none",color:l===F?"#0054ce":"black"},className:"d-l-sm-item bdr-btm-grey flex align-center",children:[t.jsx(nt,{className:"d-l-sm-icon",src:et,alt:"draggable icon"}),t.jsx("div",{className:"margin-left-xs",children:x.parentName}),t.jsxs("div",{className:"flex-grow-1 flex justify-end",children:[t.jsx("div",{className:"margin-right-s",children:P(x)}),x.childrens&&x.childrens.length?t.jsx(tt,{onClick:()=>{o.indexOf(x.parentId)>-1?this.setState({openedParent:o.filter(u=>u!==x.parentId)}):this.setState({openedParent:[...o,x.parentId]})},className:"pointer-cr",name:`chevron ${o.indexOf(x.parentId)>-1?"up":"down"}`}):""]})]}),o.indexOf(x.parentId)>-1&&this.renderChildrens(x)]})},x.parentId)),g.placeholder]})})})})},this.state={showDataSchemaError:!1,dataList:[],openedParent:[],selectedIndex:null}}componentDidUpdate(a){if(this.props.dataList!==a.dataList){const{dataList:r,dataSchema:o}=this.props;if(pe.schemaValidator(o)){const l=pe.mapDataWithSchema(r,o);this.setState({dataList:l||[],showDataSchemaError:!1})}else this.setState({showDataSchemaError:!0})}}componentDidMount(){const{dataList:a,dataSchema:r}=this.props;if(pe.schemaValidator(r)){const o=pe.mapDataWithSchema(a,r);this.setState({dataList:o||[],showDataSchemaError:!1})}else this.setState({showDataSchemaError:!0})}render(){const{showDataSchemaError:a}=this.state;return t.jsx(t.Fragment,{children:a?t.jsx("div",{children:"Wrong Schema"}):t.jsx("div",{children:this.renderList()})})}}Se.defaultProps={};Se.__docgenInfo={description:"",methods:[{name:"onDragEnd",docblock:`Function to notify when an item position is changed to parent by onDragEnd function
which is passed by the parent to this component
@param {Object} result contains the info of old index and new index of the item in the list`,modifiers:[],params:[{name:"result",description:"contains the info of old index and new index of the item in the list",type:{name:"any"},optional:!1}],returns:null,description:`Function to notify when an item position is changed to parent by onDragEnd function
which is passed by the parent to this component`},{name:"renderChildrens",docblock:`Function to render childrens of a draggable Item
@param {Object} parent contains parent info with the childrens array`,modifiers:[],params:[{name:"parent",description:"contains parent info with the childrens array",type:{name:"any"},optional:!1}],returns:null,description:"Function to render childrens of a draggable Item"},{name:"renderList",docblock:"Function to render the draggable List using react-beautiful-dnd",modifiers:[],params:[],returns:null,description:"Function to render the draggable List using react-beautiful-dnd"}],displayName:"PivotDraggable",props:{dataList:{required:!1,tsType:{name:"Array",elements:[{name:"object"}],raw:"object[]"},description:""},dataSchema:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  parentId?: string,
  parentName?: string,
  childrenElement?: string,
  childName?: string,
  childId?: string
}`,signature:{properties:[{key:"parentId",value:{name:"string",required:!1}},{key:"parentName",value:{name:"string",required:!1}},{key:"childrenElement",value:{name:"string",required:!1}},{key:"childName",value:{name:"string",required:!1}},{key:"childId",value:{name:"string",required:!1}}]}},description:""},label:{required:!1,tsType:{name:"string"},description:""},parentItemElem:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: any[]) => any",signature:{arguments:[{type:{name:"Array",elements:[{name:"any"}],raw:"any[]"},name:"args",rest:!0}],return:{name:"any"}}},description:""},childrenItemElem:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: any[]) => any",signature:{arguments:[{type:{name:"Array",elements:[{name:"any"}],raw:"any[]"},name:"args",rest:!0}],return:{name:"any"}}},description:""},onDragEnd:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: any[]) => any",signature:{arguments:[{type:{name:"Array",elements:[{name:"any"}],raw:"any[]"},name:"args",rest:!0}],return:{name:"any"}}},description:""},identifier:{required:!0,tsType:{name:"string"},description:""},selectParent:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: any[]) => any",signature:{arguments:[{type:{name:"Array",elements:[{name:"any"}],raw:"any[]"},name:"args",rest:!0}],return:{name:"any"}}},description:""},selectChild:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: any[]) => any",signature:{arguments:[{type:{name:"Array",elements:[{name:"any"}],raw:"any[]"},name:"args",rest:!0}],return:{name:"any"}}},description:""}}};const te={FLAT:"flat",PIVOT:"pivot",HIERARCHY:"hierarchy"},de={ROW:"row",COL:"col"},A=(i,a,r)=>{const o=(r==null?void 0:r.find(l=>l.field===a))||{isCurrency:!1,isDate:!1,isTime:!1,isMetric:!1,currencyType:"USD"};if(o.isCurrency&&typeof i=="number"){let l=o.currencySymbol;switch(l||(l={USD:"$",EUR:"€",GBP:"£",INR:"₹",JPY:"¥",AED:"د.إ",CNY:"¥",RUB:"₽"}[o.currencyType||"USD"]||"$"),o.currencyType){case"JPY":case"CNY":return`${l}${Math.round(i).toLocaleString()}`;case"INR":return`${l}${i.toLocaleString("en-IN")}`;default:return`${l}${i.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}}if(o.isDate&&i)try{return new Date(i.toString()).toLocaleDateString()}catch{return i}return(a.toLowerCase().includes("percent")||a.toLowerCase().includes("%"))&&typeof i=="number"?`${i.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}%`:typeof i=="number"?i.toLocaleString():i},Ce={SUM:"sum",COUNT:"count",AVG:"avg"},ye=(i,a)=>{if(i.length===0)return"";switch(a){case Ce.SUM:return i.reduce((r,o)=>r+o,0);case Ce.COUNT:return i.length;case Ce.AVG:return(i.reduce((r,o)=>r+o,0)/i.length).toFixed(2);default:return""}};function ot(i,a,r,o){const{rowFields:l,columnFields:P,aggregation:I}=a,g=(r==null?void 0:r.filter(p=>p.isMetric).map(p=>p.field))||[],W=P.filter(p=>!g.includes(p));let x=P.filter(p=>g.includes(p));if(W.length===0){const p=P.filter(b=>g.includes(b)),k=[...l,...p],L=i.map(b=>[...l.map(E=>A(b[E],E,r)),...p.map(E=>A(b[E],E,r))]);return{headers:k,table:L}}const F=W[0];let y;if(x.length>0?y=x[0]:o&&g.includes(o)?y=o:y=g.find(p=>p!==F&&!l.includes(p)),!y){const p=[...l,F],k=i.map(L=>[...l.map(b=>A(L[b],b,r)),A(L[F],F,r)]);return{headers:p,table:k}}const _=Array.from(new Set(i.map(p=>p[F]))).map(String).sort();let u;x.length>0?(u=[...l],x.forEach(p=>{_.forEach(k=>{u.push(`${p} (${k})`)})})):u=[...l,..._];const U=new Map;i.forEach(p=>{const k=l.map(L=>String(p[L])).join("||");U.has(k)||U.set(k,[]),U.get(k).push(p)});const J=[];for(const[p,k]of Array.from(U.entries())){const L=p.split("||");if(x.length>0){const b=[...L];x.forEach(m=>{_.forEach(E=>{const $=k.filter(N=>String(N[F])===E);let j="";if($.length>0){const N=$.map(z=>Number(z[m])||0);j=ye(N,I)}b.push(A(j,m,r))})}),J.push(b)}else{const b=[...L];_.forEach(m=>{const E=k.filter(j=>String(j[F])===m);let $="";if(E.length>0){const j=E.map(N=>Number(N[y])||0);$=ye(j,I)}b.push(A($,y,r))}),J.push(b)}}return{headers:u,table:J}}function lt(i,a,r){const{rowFields:o,columnFields:l,aggregation:P}=a;if(o.length===0)return{rowFieldHeaderName:"",nonPivotedDimensionColumnNames:[],metricColumnNames:[],hierarchicalData:[]};const I=(r==null?void 0:r.filter(y=>y.isMetric).map(y=>y.field))||[],g=l.filter(y=>!I.includes(y)),W=l.filter(y=>I.includes(y));[o[0],...g,...W];const x=(y,_,u="root")=>{if(_>=o.length)return[];const U=o[_],J=new Map;y.forEach(b=>{const m=b[U];J.has(m)||J.set(m,[]),J.get(m).push(b)});const p=[];let k=0,L=[];if(g.length>0){const b=g[0];L=Array.from(new Set(i.map(m=>String(m[b])))).sort()}for(const[b,m]of Array.from(J.entries())){const E=`${u}_${U}_${String(b).replace(/\s+/g,"-")}_${k++}`,$={},j={},N={};I.forEach(s=>{var X;if((X=r==null?void 0:r.find(R=>R.field===s))==null?void 0:X.isDate){const R=m.map(q=>q[s]?new Date(q[s].toString()):null).filter(q=>q&&!isNaN(q.getTime()));if(R.length>0){const q=new Date(Math.max(...R.map(M=>M?M.getTime():0)));$[s]=q.toISOString()}else $[s]="";if(j[s]={},g.length>0){const q=g[0];L.forEach(M=>{j[s][M]="-"}),L.forEach(M=>{const Q=m.filter(G=>String(G[q])===String(M)).map(G=>G[s]?new Date(G[s].toString()):null).filter(G=>G&&!isNaN(G.getTime()));if(Q.length>0){const G=new Date(Math.max(...Q.map(se=>se?se.getTime():0)));j[s][M]=G.toISOString()}})}}else{const R=m.map(q=>Number(q[s])||0);if($[s]=ye(R,P),j[s]={},g.length>0){const q=g[0];L.forEach(M=>{j[s][M]=0}),L.forEach(M=>{const ne=m.filter(Q=>String(Q[q])===String(M));if(ne.length>0){const Q=ne.map(G=>Number(G[s])||0);j[s][M]=ye(Q,P)}})}}}),m.length>0&&g.forEach(s=>{N[s]=m[0][s]});const z=x(m,_+1,E);p.push({id:E,values:[],level:_+1,children:z,aggregates:$,pivotedAggregates:j,fieldName:U,fieldValue:b,dimensionValues:N})}return p.sort((b,m)=>String(b.fieldValue).localeCompare(String(m.fieldValue)))},F=x(i,0);return{rowFieldHeaderName:o[0],pivotDimensionInfo:g.length>0?{name:g[0],uniqueValues:Array.from(new Set(i.map(y=>String(y[g[0]])))).sort()}:void 0,nonPivotedDimensionColumnNames:g.slice(1),metricColumnNames:W,hierarchicalData:F}}const ve=({data:i,headers:a=[],initialRowFields:r=[],initialColumnFields:o=[],config:l,defaultValueField:P="sales",pagination:I=!1,currentPage:g=1,totalPage:W=1,onPrevPage:x,onNextPage:F})=>{const y=Object.keys(i[0]||{}),_=a.filter(e=>!e.isMetric).map(e=>e.field),u=a.filter(e=>e.isMetric).map(e=>e.field),[U,J]=Y.useState({rowFields:r,columnFields:o.length>0?o:u,breadcrumbPath:[]}),[p,k]=Y.useState({openCard:null,view:r.length===0&&o.filter(e=>!u.includes(e)).length===0?te.FLAT:te.PIVOT,isAddDimensionsOpen:!0,isColSelected:o.some(e=>!u.includes(e)),hierarchyKey:0}),[L,b]=Y.useState({expandedRows:new Set,collapsedColumns:(()=>{const e=U.columnFields.find(n=>!u.includes(n));return e?new Set([e]):new Set})(),collapsedMetrics:new Set(u)}),m=Y.useRef({rowFields:U.rowFields,columnFields:U.columnFields}),E=Y.useRef(null),$=Y.useRef(null),j=e=>{J(n=>({...n,...e}))},N=e=>{k(n=>({...n,...e}))},z=e=>{b(n=>({...n,...e}))},{rowFields:s,columnFields:f}=U,{view:X,openCard:R,isColSelected:q,isAddDimensionsOpen:M,hierarchyKey:ne}=p,{expandedRows:Q,collapsedColumns:G,collapsedMetrics:se}=L;Y.useEffect(()=>{function e(n){R!==null&&E.current&&!E.current.contains(n.target)&&$.current&&!$.current.contains(n.target)&&N({openCard:null})}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[R]);const ue=_.length?_:y.filter(e=>{const n=i.slice(0,20);return n.filter(v=>typeof v[e]=="string").length>n.length/2});Array.from(new Set(ue)),Y.useEffect(()=>{const e=f.some(v=>!u.includes(v));let n;s.length===0&&!e?n=te.FLAT:s.length>0?n=te.HIERARCHY:n=te.PIVOT,X!==n&&N({view:n}),(!we(m.current.rowFields,s)||!we(m.current.columnFields.filter(v=>!u.includes(v)),f.filter(v=>!u.includes(v))))&&z({expandedRows:new Set}),m.current={rowFields:[...s],columnFields:[...f]}},[s,f,u,X]),Y.useEffect(()=>{s.length>0&&((m.current.rowFields.length!==s.length||!we(m.current.rowFields,s))&&z({expandedRows:new Set}),JSON.stringify(m.current.rowFields)!==JSON.stringify(s)||JSON.stringify(m.current.columnFields)!==JSON.stringify(f)?N({hierarchyKey:Date.now()}):m.current.rowFields!==s&&N({hierarchyKey:ne+1})),m.current={rowFields:[...s],columnFields:[...f]}},[s,f]);const we=(e,n)=>{if(e.length!==n.length)return!1;for(let c=0;c<e.length;c++)if(e[c]!==n[c])return!1;return!0},Pe=(e,n)=>{if(e===n)return;const c=[...s],[v]=c.splice(e,1);c.splice(n,0,v),z({expandedRows:new Set}),N({hierarchyKey:ne+1}),j({rowFields:c})},He=e=>{var n,c;e&&typeof((n=e.source)==null?void 0:n.index)=="number"&&typeof((c=e.destination)==null?void 0:c.index)=="number"?Pe(e.source.index,e.destination.index):e&&typeof e.oldIndex=="number"&&typeof e.newRank=="number"?Pe(e.oldIndex,e.newRank):console.error("Invalid drag data format. Expected source/destination indices:",e)},{tableHeaders:je,tableData:_e,hierarchicalResult:Te}=Y.useMemo(()=>{const e={rowFields:[...s],columnFields:[...f],aggregation:(l==null?void 0:l.aggregation)||"sum"},n=s.length===0,c=f.every(h=>u.includes(h)),v=f.some(h=>!u.includes(h));if(n&&v){const h=Array.from(new Set([...f])),C=i.map(Z=>h.map(B=>A(Z[B]??"",B,a)));return{tableHeaders:h,tableData:C,hierarchicalResult:void 0}}else if(X===te.FLAT||n&&c){const h=y,C=i.map(Z=>h.map(B=>A(Z[B]??"",B,a)));return{tableHeaders:h,tableData:C,hierarchicalResult:void 0}}else if(X===te.HIERARCHY&&s.length>0){const h=lt(i,e,a);return{tableHeaders:[],tableData:[],hierarchicalResult:h}}else{const{headers:h,table:C}=ot(i,e,a,P);return{tableHeaders:h,tableData:C,hierarchicalResult:void 0}}},[i,a,X,JSON.stringify(s),JSON.stringify(f),u,P,y,se,ne,l==null?void 0:l.aggregation]),xe=(e,n)=>{var v;const c=(v=a.find(h=>h.field===e))==null?void 0:v.isMetric;if(n===de.ROW){const h=s.includes(e)?s.filter(C=>C!==e):[...s,e];j({rowFields:h}),c||j({columnFields:f.filter(C=>C!==e)})}else if(n===de.COL){N({isColSelected:!q});let h=[...f];if(c)h=f.includes(e)?f.filter(C=>C!==e):[...f,e];else if(f.includes(e))h=f.filter(C=>C!==e||u.includes(C));else{const C=f.filter(Z=>u.includes(Z));h=[e,...C]}j({columnFields:h}),c||j({rowFields:s.filter(C=>C!==e)})}},$e=e=>{const n=new Set(Q);n.has(e)?n.delete(e):n.add(e),z({expandedRows:n})},Ue=e=>{const n=new Set(se);n.has(e)?n.delete(e):n.add(e),z({collapsedMetrics:n})},We=(e,n,c,v,h)=>{const{pivotDimensionInfo:C,nonPivotedDimensionColumnNames:Z,metricColumnNames:B}=n,me=v?t.jsx("div",{className:"toggle-control-wrapper",style:{paddingLeft:`${(c-1)*16}px`},children:t.jsx("div",{className:"row-toggle-control",onClick:S=>{S.stopPropagation(),$e(e.id)},children:t.jsx(Ne,{icon:h?"chevron down":"chevron right",color:"black",style:{fontSize:"14px"}})})}):t.jsx("div",{className:"toggle-spacer-wrapper",style:{paddingLeft:`${(c-1)*16}px`},children:c>1&&t.jsx("span",{className:"toggle-indent-marker"})}),be=t.jsx("div",{className:"field-value-with-level","data-level":c,"data-has-children":v?"true":"false",children:t.jsx("div",{className:`field-value-content ${v?"has-children":""}`,"data-level":c,children:e.fieldValue})}),O=[me,be];return Z.forEach(S=>{var ae;const ee=((ae=e.dimensionValues)==null?void 0:ae[S])??"";O.push(t.jsx("div",{className:"dimension-cell",children:A(ee,S,a)}))}),C&&C.uniqueValues.length>0?B.forEach(S=>{if(se.has(S)){const d=a.find(w=>w.field===S),D=d==null?void 0:d.isDate,V=C.uniqueValues;if(D){let w=null,T=!1;V.forEach(K=>{var oe,ge;const H=(ge=(oe=e.pivotedAggregates)==null?void 0:oe[S])==null?void 0:ge[K];if(H&&H!=="-")try{const re=new Date(H.toString());isNaN(re.getTime())||(T=!0,(!w||re>w)&&(w=re))}catch{}}),O.push(t.jsx("div",{className:"metric-cell collapsed",children:T&&w?A(w,S,a):"-"}))}else{let w=0;V.forEach(T=>{var H,oe;const K=((oe=(H=e.pivotedAggregates)==null?void 0:H[S])==null?void 0:oe[T])??0;w+=Number(K)||0}),O.push(t.jsx("div",{className:"metric-cell collapsed",children:A(w,S,a)}))}return}const ee=a.find(d=>d.field===S),ae=ee==null?void 0:ee.isDate,ie=C.uniqueValues;if(ie.length>1)if(ae){let d=null,D=!1;ie.forEach(V=>{var T,K;const w=(K=(T=e.pivotedAggregates)==null?void 0:T[S])==null?void 0:K[V];if(w&&w!=="-")try{const H=new Date(w.toString());isNaN(H.getTime())||(D=!0,(!d||H>d)&&(d=H))}catch{}}),O.push(t.jsx("div",{className:"metric-cell total-cell",children:D&&d?A(d,S,a):"-"}))}else{let d=0;ie.forEach(D=>{var w,T;const V=((T=(w=e.pivotedAggregates)==null?void 0:w[S])==null?void 0:T[D])??0;d+=Number(V)||0}),O.push(t.jsx("div",{className:"metric-cell total-cell",children:A(d,S,a)}))}ie.forEach(d=>{var V,w;const D=(w=(V=e.pivotedAggregates)==null?void 0:V[S])==null?void 0:w[d];if(ae)if(!D||D===""||D==="-")O.push(t.jsx("div",{className:"metric-cell",children:"-"}));else try{const T=new Date(D.toString());isNaN(T.getTime())?O.push(t.jsx("div",{className:"metric-cell",children:"-"})):O.push(t.jsx("div",{className:"metric-cell",children:A(D,S,a)}))}catch{O.push(t.jsx("div",{className:"metric-cell",children:"-"}))}else O.push(t.jsx("div",{className:"metric-cell",children:A(D??0,S,a)}))})}):B.forEach(S=>{const ee=e.aggregates[S];O.push(t.jsx("div",{className:"metric-cell",children:A(ee,S,a)}))}),O},Ge=(e,n)=>{if(e==="toggle")return t.jsx("div",{className:"toggle-column-header"});if(n){let v="header-dimension";return n==="Total"&&(v+=" total-header"),t.jsx("div",{className:v,children:n})}const c=a.find(v=>v.field===e);if(c!=null&&c.isMetric){let v="metric-header";return t.jsx("div",{className:v,children:e})}return t.jsx("div",{className:"dimension-header",children:e})},Ze=e=>{if(!e||e.hierarchicalData.length===0)return null;const{rowFieldHeaderName:n,pivotDimensionInfo:c,nonPivotedDimensionColumnNames:v,metricColumnNames:h,hierarchicalData:C}=e,Z=["toggle",n];Z.push(...v);const B=c!==void 0,me=B&&s.length>0;B?h.forEach(d=>{Z.push(d)}):Z.push(...h);const be=me?h.map(d=>{if(se.has(d))return{header:d,isCollapsed:!0,subColumns:[]};{const V=(c==null?void 0:c.uniqueValues)||[],w=V.length>1?["Total",...V]:V;return{header:d,isCollapsed:!1,subColumns:w.map(T=>String(T))}}}):[],O=(d,D=1,V=!0)=>{let w=[],T=[];return d.forEach(K=>{const H=Q.has(K.id);if(D===1||V){const ge=We(K,e,D,K.children.length>0,H);if(w.push(ge),T.push(D),H&&K.children.length>0){const re=O(K.children,D+1,H);w=[...w,...re.rows],T=[...T,...re.levels]}}}),{rows:w,levels:T}},{rows:S,levels:ee}=O(C),ae=(d,D)=>t.jsx("tr",{"data-row-level":ee[D],children:d}),ie=(d,D,V)=>V===0?typeof d=="object"&&d!==null&&Fe.isValidElement(d)?d:null:d;return t.jsxs("div",{className:"lt-pivot-table-hierarchy-container",children:[s.length>0&&t.jsx("div",{className:"lt-pivot-table-breadcrumb",children:s.map((d,D)=>t.jsxs(Fe.Fragment,{children:[D>0&&t.jsx("span",{className:"breadcrumb-separator",children:">"}),t.jsx("span",{className:"breadcrumb-item",children:d})]},d))}),t.jsx(Ee,{headers:Z,cellData:S,size:"small",className:"lt-pivot-table-table",useCollapsibleColumns:me,collapsibleColumns:be,onToggleCollapse:Ue,renderCustomHeader:Ge,renderCustomCell:ie,renderCustomRow:ae,pagination:I,currentPage:g,totalPage:W,onPrevPage:x,onNextPage:F,headerClasses:{0:"toggle-column-header",1:"dimension-header primary-dimension"},columnClasses:{0:"toggle-column"}})]})},Ke=s.length>0?ce.DRAG:ce.NONESTING,Ye=()=>{s.length>0&&(j({rowFields:[]}),z({expandedRows:new Set}),N({hierarchyKey:p.hierarchyKey+1}))};return t.jsxs("div",{className:"lt-pivot-table",children:[t.jsxs("div",{className:"lt-pivot-table__controls",children:[t.jsxs("div",{className:"lt-pivot-table-button-container",ref:$,children:[t.jsx(le,{label:`Row Nesting${s.length>0?` (${s.length})`:""}`,onClick:()=>{R==="row"?N({openCard:null}):R!==null?(N({openCard:null}),setTimeout(()=>N({openCard:"row"}),10)):N({openCard:"row"})},primary:R==="row",className:"pivot-button"}),t.jsx(le,{label:`Column Nesting${f.some(e=>!u.includes(e))?` (${f.find(e=>!u.includes(e))||""})`:""}`,onClick:()=>{R==="col"?N({openCard:null}):R!==null?(N({openCard:null}),setTimeout(()=>N({openCard:"col"}),10)):N({openCard:"col"})},primary:R==="col",className:`pivot-button ${R==="col"?"pivot-button--active":""}`})]}),R==="row"&&t.jsx("div",{ref:E,children:t.jsxs(Re,{className:"pivot-table-card",header:"Row Hierarchy",children:[t.jsx("div",{className:"pivot-toggle-container",children:t.jsxs("div",{className:"flat-button-container",children:[t.jsx("p",{className:"flat",children:"Flat View"}),t.jsx(st,{checkedColor:"green",className:"pivot-table-toggle",onChange:Ye,uncheckedColor:"lightgray",checked:s.length===0})]})}),t.jsx("div",{className:"pivot-extra-card",children:t.jsxs("div",{className:"lt-pivot-table__field-selection",children:[t.jsx(Se,{dataList:s.map(e=>({key:e,value:e,selectedValues:[]})),dataSchema:{parentId:"key",parentName:"value",childrenElement:"childrens",childName:"value",childId:"key"},identifier:"row-fields",onDragEnd:He,parentItemElem:e=>t.jsx(Ne,{icon:"close",size:"small",color:"black",className:"draggable-icon",onClick:()=>{xe(e.parentName,de.ROW)}}),childrenItemElem:()=>t.jsx(t.Fragment,{}),selectParent:()=>{},selectChild:()=>{}}),t.jsx("p",{className:"add-dimension-message",children:"Add Dimension"}),t.jsx("p",{className:"row-string",children:Ke}),t.jsxs("div",{className:"pivot-table-add-dimensions-draggable-container",children:[!M&&t.jsx("div",{className:"add-dimensions-message",children:"Click on add dimensions"}),M&&t.jsx(t.Fragment,{children:ue.filter(e=>!s.includes(e)).length>0?ue.filter(e=>!s.includes(e)).map(e=>t.jsx(le,{label:e,onClick:()=>xe(e,de.ROW),disabled:f.includes(e)&&!u.includes(e),className:"add-dimensions-button"},`available-${e}`)):t.jsx("div",{className:"no-dimensions-message",children:ce.ND})})]})]})})]})}),R==="col"&&t.jsx("div",{ref:E,children:t.jsx(Re,{className:"pivot-table-card",header:"Column Nesting",children:t.jsx("div",{className:"pivot-extra-card",children:f.some(e=>!u.includes(e))?t.jsxs("div",{className:"selected-column-container",children:[t.jsx("p",{children:ce.CND}),t.jsx("div",{className:"selected-nesting-column",children:t.jsxs("div",{className:"selected-nesting-column",children:[t.jsx(le,{label:f.find(e=>!u.includes(e))||"",className:"pivot-button-selected-dimension",onClick:()=>{}}),t.jsx(Ne,{icon:"close",size:"small",color:"black",className:"remove-column-icon",onClick:()=>{const e=f.find(n=>!u.includes(n));e&&(j({columnFields:f.filter(n=>n!==e||u.includes(n))}),N({isColSelected:!1}))}})]})})]}):t.jsxs(t.Fragment,{children:[t.jsx("p",{children:ce.NCND}),t.jsx("div",{className:"lt-pivot-table__field-selection",children:ue.map(e=>u.includes(e)?null:t.jsx(le,{label:e,onClick:()=>xe(e,de.COL),disabled:s.includes(e),className:"pivot-button"},e))})]})})})})]}),t.jsx("div",{className:"lt-pivot-table__content",children:X===te.HIERARCHY&&Te?Ze(Te):t.jsx(Ee,{headers:je,cellData:_e,sortableColumns:je.map(e=>{const n=a.find(c=>c.field===e);return(n==null?void 0:n.isSortable)===!0}),onSort:function(){},pagination:I,currentPage:g,totalPage:W,onPrevPage:x,onNextPage:F,showDownload:!0,size:"small",renderCustomHeader:e=>{if(!e.includes(" ("))return e;const[n,c]=e.split(" (");return t.jsxs("div",{className:"combined-header",children:[t.jsx("div",{className:"header-metric",children:n}),t.jsx("div",{className:"header-dimension",children:c.slice(0,-1)})]})},renderCustomCell:(e,n,c)=>{}})})]})};ve.__docgenInfo={description:"",methods:[],displayName:"LtPivotTable",props:{data:{required:!0,tsType:{name:"Array",elements:[{name:"Record",elements:[{name:"string"},{name:"union",raw:"string | number",elements:[{name:"string"},{name:"number"}]}],raw:"Record<string, string | number>"}],raw:"Record<string, string | number>[]"},description:""},headers:{required:!1,tsType:{name:"Array",elements:[{name:"HeaderProperties"}],raw:"HeaderProperties[]"},description:"",defaultValue:{value:"[]",computed:!1}},initialRowFields:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:"",defaultValue:{value:"[]",computed:!1}},initialColumnFields:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:"",defaultValue:{value:"[]",computed:!1}},config:{required:!1,tsType:{name:"PivotConfig"},description:""},defaultValueField:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'sales'",computed:!1}},pagination:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},currentPage:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"1",computed:!1}},totalPage:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"1",computed:!1}},onPrevPage:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onNextPage:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const Kt={title:"Components/LtPivotTable",component:ve,tags:["autodocs"]},ct=[["P001","Product A",120,"Electronics","2025-01-01",2.5,1.2,1500,"2025-01-01T10:30:00Z"],["P002","Product B",150,"Clothing","2025-01-02",1.1,.8,700,"2025-01-02T14:20:00Z"],["P001","Product A",180,"Electronics","2025-01-10",3.2,2,2200,"2025-01-09T08:00:00Z"],["P003","Product C",200,"Electronics","2025-02-10",.9,.6,500,"2025-02-08T11:45:00Z"],["P002","Product B",160,"Clothing","2025-02-15",1.5,1.1,850,"2025-02-13T16:10:00Z"],["P004","Product D",250,"Furniture","2025-03-15",4,3.5,3200,"2025-03-14T09:00:00Z"],["P005","Product E",300,"Clothing","2025-03-18",.5,.3,200,"2025-03-17T13:30:00Z"],["P003","Product C",220,"Electronics","2025-03-25",2.1,1.8,1800,"2025-03-23T12:00:00Z"],["P006","Product F",120,"Electronics","2025-04-05",1.8,1,1100,"2025-04-04T07:40:00Z"],["P007","Product G",180,"Furniture","2025-04-07",3.5,2.7,2500,"2025-04-06T10:20:00Z"],["P001","Product A",160,"Electronics","2025-04-15",1.7,.9,1300,"2025-04-13T15:10:00Z"],["P002","Product B",140,"Clothing","2025-04-18",2.2,1.6,1e3,"2025-04-17T08:55:00Z"],["P004","Product D",260,"Furniture","2025-04-20",3,2.1,2900,"2025-04-19T11:00:00Z"]],De=[{field:"Product ID",key:"Product ID"},{field:"Product Name",key:"Product Name"},{field:"Sales",key:"Sales",isCurrency:!0,currencyType:"INR",isMetric:!0,isSortable:!0},{field:"Category",key:"Category",isMetric:!1},{field:"Date",key:"Date",isDate:!0,isMetric:!1},{field:"Downtime%",key:"downtime",isMetric:!0},{field:"Downtime hours",key:"downtimeHours",isMetric:!0},{field:"Revenue Impact",key:"RevenueImpact",isCurrency:!0,isMetric:!0},{field:"Last Downtime",key:"LastdownTime",isDate:!0,isMetric:!0}],Me=ct.map(i=>Object.fromEntries(De.map((a,r)=>[a.field,i[r]]))),Oe={width:"100%",maxWidth:"100%",overflowX:"auto",padding:"20px 0"},fe={render:i=>t.jsx("div",{style:Oe,children:t.jsx(ve,{...i})}),args:{data:Me,headers:De,pagination:!0,currentPage:1,totalPage:3,onPrevPage:()=>console.log("Previous page clicked"),onNextPage:()=>console.log("Next page clicked"),config:{rowFields:["Category","Product Name"],columnFields:["Sales"],aggregation:"sum"}}},he={render:function(){const[a,r]=Y.useState(1),o=3,l=()=>{a>1&&r(a-1)},P=()=>{a<o&&r(a+1)};return t.jsx("div",{style:Oe,children:t.jsx(ve,{data:Me,headers:De,pagination:!0,currentPage:a,totalPage:o,onPrevPage:l,onNextPage:P,config:{rowFields:["Category","Product Name"],columnFields:["Sales"],aggregation:"sum"}})})}};var Ie,Le,Ve;fe.parameters={...fe.parameters,docs:{...(Ie=fe.parameters)==null?void 0:Ie.docs,source:{originalSource:`{
  render: args => <div style={storyWrapper}>
      <LtPivotTable {...args} />
    </div>,
  args: {
    data: transformedData,
    headers,
    // Updated headers
    pagination: true,
    // Enable pagination
    currentPage: 1,
    // Set initial page
    totalPage: 3,
    // Set total pages
    onPrevPage: () => console.log('Previous page clicked'),
    onNextPage: () => console.log('Next page clicked'),
    config: {
      rowFields: ['Category', 'Product Name'],
      //required for row field
      columnFields: ['Sales'],
      //required for column field
      aggregation: 'sum' //required for total field calculation
    }
  }
}`,...(Ve=(Le=fe.parameters)==null?void 0:Le.docs)==null?void 0:Ve.source}}};var ke,Ae,qe;he.parameters={...he.parameters,docs:{...(ke=he.parameters)==null?void 0:ke.docs,source:{originalSource:`{
  render: function Render() {
    // Set up state for pagination
    const [currentPage, setCurrentPage] = useState(1);
    const totalPages = 3;

    // Handlers for pagination
    const handlePrevPage = () => {
      if (currentPage > 1) {
        setCurrentPage(currentPage - 1);
      }
    };
    const handleNextPage = () => {
      if (currentPage < totalPages) {
        setCurrentPage(currentPage + 1);
      }
    };
    return <div style={storyWrapper}>
        <LtPivotTable data={transformedData} headers={headers} pagination={true} currentPage={currentPage} totalPage={totalPages} onPrevPage={handlePrevPage} onNextPage={handleNextPage} config={{
        rowFields: ['Category', 'Product Name'],
        columnFields: ['Sales'],
        aggregation: 'sum'
      }} />
      </div>;
  }
}`,...(qe=(Ae=he.parameters)==null?void 0:Ae.docs)==null?void 0:qe.source}}};const Yt=["Default","WithInteractivePagination"];export{fe as Default,he as WithInteractivePagination,Yt as __namedExportsOrder,Kt as default};

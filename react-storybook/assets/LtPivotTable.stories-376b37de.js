import{j as t}from"./jsx-runtime-8406ef1e.js";import{r as Y,R as Fe}from"./index-ad58220e.js";import{L as Ie}from"./ltTable-b4afc241.js";import{L as Je}from"./ltButton-612ce8c0.js";import{L as Ee}from"./ltCardV2-9251f780.js";import{S as de}from"./stringConstants-f1def6f8.js";import{D as ze,C as Xe,P as Qe}from"./react-beautiful-dnd.esm-970fb784.js";import{g as et}from"./requestIdGenerator-f6efc017.js";import{h as fe}from"./util-bfaa5c4b.js";import{D as tt}from"./grippy-fc4fd531.js";import{I as nt}from"./Icon-370c2d23.js";import{I as st}from"./Label-d5345000.js";import{L as it}from"./ltToggle-748b0678.js";import{L as xe}from"./index-6dcb29cb.js";import"./_commonjsHelpers-de833af9.js";import"./extends-4c19d496.js";import"./map-20538cdf.js";import"./getElementType-ff0d42f5.js";import"./childrenUtils-dd3b0ba5.js";import"./factories-df82d7d3.js";import"./styled-components.browser.esm-675ea4f2.js";import"./Button-21321eef.js";import"./inheritsLoose-5494d9cc.js";import"./Ref-51c42093.js";import"./objectWithoutPropertiesLoose-f3b3ace0.js";import"./index-4fee7e45.js";import"./Header-30441d32.js";import"./Card-7a020250.js";import"./toPropertyKey-4015efc6.js";import"./tiny-invariant-dd7d57d2.js";import"./ModernAutoControlledComponent-6bbe7d3d.js";import"./assertThisInitialized-081f9914.js";import"./htmlPropsUtils-2b22d933.js";import"./includes-192f9362.js";import"./Portal-8d2f321a.js";import"./Checkbox-cb5dd6fb.js";import"./_baseSet-d58de3a8.js";const at="_ltPivotTable_10i0c_1",ot="_ui_10i0c_8",rt="_table_10i0c_8",lt="_ltPivotTable__controls_10i0c_12",ct="_ltPivotTable__content_10i0c_20",dt="_paginationFooter_10i0c_24",ut="_paginationBtnGroup_10i0c_31",mt="_disabled_10i0c_43",gt="_ltPivotTableButtonContainer_10i0c_49",pt="_pivotButton_10i0c_55",ft="_pivotTableCard_10i0c_72",ht="_pivotTableAddDimensionsDraggableContainer_10i0c_84",_t="_ltPivotDraggable_10i0c_95",Ct="_isDragging_10i0c_110",bt="_ltPivotTableTable_10i0c_114",vt="_fixedWidthCell_10i0c_117",yt="_expandableRow_10i0c_127",wt="_expanded_10i0c_133",xt="_combinedHeader_10i0c_136",Nt="_headerMetric_10i0c_143",St="_headerDimension_10i0c_143",Tt="_totalColumn_10i0c_151",Dt="_totalCell_10i0c_155",Pt="_total_10i0c_151",jt="_metricCell_10i0c_159",Ft="_totalRow_10i0c_167",It="_dLSmContainer_10i0c_172",Et="_dSFixedHeader_10i0c_188",Rt="_dSmChildren_10i0c_194",Lt="_dLSmItem_10i0c_197",Vt="_selected_10i0c_210",At="_dLSmItemChild_10i0c_214",kt="_dLSmIcon_10i0c_226",Mt="_marginLeftXs_10i0c_235",Ht="_marginRightS_10i0c_242",$t="_flex_10i0c_253",Bt="_alignCenter_10i0c_256",qt="_justifyEnd_10i0c_259",Ot="_flexGrow1_10i0c_262",Gt="_pointerCr_10i0c_265",Wt="_pivotExtraCard_10i0c_274",Ut="_collapsibleColumn_10i0c_291",Zt="_collapsibleColumn__header_10i0c_294",Kt="_collapsibleColumn__content_10i0c_298",Yt="_collapsibleColumn__toggle_10i0c_313",Jt="_icon_10i0c_329",zt="_metricHeaderCell_10i0c_334",Xt="_metricCollapseButton_10i0c_334",Qt="_draggableIcon_10i0c_352",en="_addDimensionsButton_10i0c_355",tn="_breadcrumbItem_10i0c_380",nn="_breadcrumbSeparator_10i0c_387",sn="_subMetric_10i0c_393",an="_dimensionHeader_10i0c_400",on="_ltPivotTableFieldSelection_10i0c_405",rn="_selectedNestingColumn_10i0c_421",ln="_pivotButtonSelectedDimension_10i0c_425",cn="_removeColumnIcon_10i0c_430",dn="_rowString_10i0c_440",un="_addDimensionMessage_10i0c_467",mn="_flat_10i0c_474",gn="_flatButtonContainer_10i0c_481",pn="_pivotTableToggle_10i0c_491",fn="_ltPivotTableControls_10i0c_497",hn="_allColumnDimensionButton_10i0c_506",n={ltPivotTable:at,ui:ot,table:rt,ltPivotTable__controls:lt,ltPivotTable__content:ct,paginationFooter:dt,paginationBtnGroup:ut,disabled:mt,ltPivotTableButtonContainer:gt,pivotButton:pt,"pivotButton--active":"_pivotButton--active_10i0c_67",pivotTableCard:ft,pivotTableAddDimensionsDraggableContainer:ht,ltPivotDraggable:_t,isDragging:Ct,ltPivotTableTable:bt,fixedWidthCell:vt,expandableRow:yt,expanded:wt,combinedHeader:xt,headerMetric:Nt,headerDimension:St,totalColumn:Tt,totalCell:Dt,total:Pt,metricCell:jt,totalRow:Ft,dLSmContainer:It,dSFixedHeader:Et,dSmChildren:Rt,dLSmItem:Lt,selected:Vt,dLSmItemChild:At,dLSmIcon:kt,marginLeftXs:Mt,marginRightS:Ht,flex:$t,alignCenter:Bt,justifyEnd:qt,flexGrow1:Ot,pointerCr:Gt,pivotExtraCard:Wt,collapsibleColumn:Ut,collapsibleColumn__header:Zt,collapsibleColumn__content:Kt,collapsibleColumn__toggle:Yt,icon:Jt,metricHeaderCell:zt,metricCollapseButton:Xt,draggableIcon:Qt,addDimensionsButton:en,"ltPivotTable-breadcrumb":"_ltPivotTable-breadcrumb_10i0c_367",breadcrumbItem:tn,breadcrumbSeparator:nn,subMetric:sn,dimensionHeader:an,ltPivotTableFieldSelection:on,selectedNestingColumn:rn,pivotButtonSelectedDimension:ln,removeColumnIcon:cn,rowString:dn,addDimensionMessage:un,flat:mn,flatButtonContainer:gn,pivotTableToggle:pn,ltPivotTableControls:fn,allColumnDimensionButton:hn},ce=({label:r,active:a=!1,primary:o=!1,onClick:l,disabled:c=!1,className:D="",id:R,children:p})=>{const W=[n.pivotButton,a?n.pivotButtonActive:"",D].filter(Boolean).join(" ");return t.jsx(Je,{label:r,onClick:l,disabled:c,className:W,id:R,border:!0,size:"small",primary:o,children:p&&t.jsx("span",{className:n.pivotButtonIcon,children:p})})};ce.__docgenInfo={description:"",methods:[],displayName:"PivotTableButton",props:{label:{required:!0,tsType:{name:"string"},description:""},active:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},primary:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onClick:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},disabled:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},className:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'""',computed:!1}},id:{required:!1,tsType:{name:"string"},description:""},children:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}};const _n=(r,a)=>({userSelect:"none",background:r?"darkgrey":"white",...a}),Cn=(r,a,o)=>{const l=Array.from(r),[c]=l.splice(a,1);return l.splice(o,0,c),l},bn=r=>({background:r?"grey":"white"});class Se extends Y.Component{constructor(a){super(a),this.onDragEnd=o=>{if(!o.destination)return;const{dataList:l}=this.state,c=Cn(l,o.source.index,o.destination.index);this.setState({dataList:c,selectedIndex:o.destination.index},()=>{const{onDragEnd:D,identifier:R}=this.props,p={oldIndex:o.source.index,newRank:o.destination.index,identifier:R};D&&D(p)})},this.renderChildrens=o=>{const{childrenItemElem:l,selectChild:c}=this.props;return t.jsx("div",{children:o.childrens.map((D,R)=>t.jsxs("div",{onClick:()=>{c(D)},tabIndex:R,onKeyDown:()=>{},role:"button",className:`${n.dLSmItemChild} ${n.flex} ${n.alignCenter} ${n.dSmChildren}`,children:[t.jsx("div",{children:D.childName}),t.jsx("div",{className:`${n.flexGrow1} ${n.justifyEnd} ${n.flex}`,children:l(D)})]},et()))})},this.renderList=()=>{const{dataList:o,openedParent:l,selectedIndex:c}=this.state,{parentItemElem:D,selectParent:R}=this.props;return t.jsx("div",{children:t.jsx(ze,{onDragEnd:this.onDragEnd,children:t.jsx(Xe,{droppableId:"droppable",children:(p,W)=>t.jsxs("div",{...p.droppableProps,ref:p.innerRef,style:bn(W.isDraggingOver),children:[o.map((y,F)=>t.jsx(Qe,{draggableId:y.parentId,index:F,children:(C,q)=>t.jsxs("div",{onClick:()=>{this.setState({selectedIndex:F}),R(y)},tabIndex:F,role:"button",onKeyDown:()=>{},ref:C.innerRef,...C.draggableProps,...C.dragHandleProps,style:_n(q.isDragging,C.draggableProps.style),children:[t.jsxs("div",{style:{borderLeft:c===F?"4px solid #0054ce":"none",color:c===F?"#0054ce":"black"},className:`${n.dLSmItem} ${n.flex} ${n.alignCenter}`,children:[t.jsx(st,{className:n.dLSmIcon,src:tt,alt:"draggable icon"}),t.jsx("div",{className:n.marginLeftXs,children:y.parentName}),t.jsxs("div",{className:`${n.flexGrow1} ${n.flex} ${n.justifyEnd}`,children:[t.jsx("div",{className:n.marginRightS,children:D(y)}),y.childrens&&y.childrens.length?t.jsx(nt,{onClick:()=>{l.indexOf(y.parentId)>-1?this.setState({openedParent:l.filter(m=>m!==y.parentId)}):this.setState({openedParent:[...l,y.parentId]})},className:n.pointerCr,name:`chevron ${l.indexOf(y.parentId)>-1?"up":"down"}`}):""]})]}),l.indexOf(y.parentId)>-1&&this.renderChildrens(y)]})},y.parentId)),p.placeholder]})})})})},this.state={showDataSchemaError:!1,dataList:[],openedParent:[],selectedIndex:null}}componentDidUpdate(a){if(this.props.dataList!==a.dataList){const{dataList:o,dataSchema:l}=this.props;if(fe.schemaValidator(l)){const c=fe.mapDataWithSchema(o,l);this.setState({dataList:c||[],showDataSchemaError:!1})}else this.setState({showDataSchemaError:!0})}}componentDidMount(){const{dataList:a,dataSchema:o}=this.props;if(fe.schemaValidator(o)){const l=fe.mapDataWithSchema(a,o);this.setState({dataList:l||[],showDataSchemaError:!1})}else this.setState({showDataSchemaError:!0})}render(){const{showDataSchemaError:a}=this.state;return t.jsx(t.Fragment,{children:a?t.jsx("div",{children:"Wrong Schema"}):t.jsx("div",{children:this.renderList()})})}}Se.defaultProps={};Se.__docgenInfo={description:"",methods:[{name:"onDragEnd",docblock:`Function to notify when an item position is changed to parent by onDragEnd function
which is passed by the parent to this component
@param {Object} result contains the info of old index and new index of the item in the list`,modifiers:[],params:[{name:"result",description:"contains the info of old index and new index of the item in the list",type:{name:"any"},optional:!1}],returns:null,description:`Function to notify when an item position is changed to parent by onDragEnd function
which is passed by the parent to this component`},{name:"renderChildrens",docblock:`Function to render childrens of a draggable Item
@param {Object} parent contains parent info with the childrens array`,modifiers:[],params:[{name:"parent",description:"contains parent info with the childrens array",type:{name:"any"},optional:!1}],returns:null,description:"Function to render childrens of a draggable Item"},{name:"renderList",docblock:"Function to render the draggable List using react-beautiful-dnd",modifiers:[],params:[],returns:null,description:"Function to render the draggable List using react-beautiful-dnd"}],displayName:"PivotDraggable",props:{dataList:{required:!1,tsType:{name:"Array",elements:[{name:"object"}],raw:"object[]"},description:""},dataSchema:{required:!1,tsType:{name:"signature",type:"object",raw:`{
  parentId?: string,
  parentName?: string,
  childrenElement?: string,
  childName?: string,
  childId?: string
}`,signature:{properties:[{key:"parentId",value:{name:"string",required:!1}},{key:"parentName",value:{name:"string",required:!1}},{key:"childrenElement",value:{name:"string",required:!1}},{key:"childName",value:{name:"string",required:!1}},{key:"childId",value:{name:"string",required:!1}}]}},description:""},label:{required:!1,tsType:{name:"string"},description:""},parentItemElem:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: any[]) => any",signature:{arguments:[{type:{name:"Array",elements:[{name:"any"}],raw:"any[]"},name:"args",rest:!0}],return:{name:"any"}}},description:""},childrenItemElem:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: any[]) => any",signature:{arguments:[{type:{name:"Array",elements:[{name:"any"}],raw:"any[]"},name:"args",rest:!0}],return:{name:"any"}}},description:""},onDragEnd:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: any[]) => any",signature:{arguments:[{type:{name:"Array",elements:[{name:"any"}],raw:"any[]"},name:"args",rest:!0}],return:{name:"any"}}},description:""},identifier:{required:!0,tsType:{name:"string"},description:""},selectParent:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: any[]) => any",signature:{arguments:[{type:{name:"Array",elements:[{name:"any"}],raw:"any[]"},name:"args",rest:!0}],return:{name:"any"}}},description:""},selectChild:{required:!1,tsType:{name:"signature",type:"function",raw:"(...args: any[]) => any",signature:{arguments:[{type:{name:"Array",elements:[{name:"any"}],raw:"any[]"},name:"args",rest:!0}],return:{name:"any"}}},description:""}}};const ne={FLAT:"flat",PIVOT:"pivot",HIERARCHY:"hierarchy"},ue={ROW:"row",COL:"col"},k=(r,a,o)=>{const l=(o==null?void 0:o.find(c=>c.field===a))||{isCurrency:!1,isDate:!1,isTime:!1,isMetric:!1,currencyType:"USD"};if(l.isCurrency&&typeof r=="number"){let c=l.currencySymbol;switch(c||(c={USD:"$",EUR:"€",GBP:"£",INR:"₹",JPY:"¥",AED:"د.إ",CNY:"¥",RUB:"₽"}[l.currencyType||"USD"]||"$"),l.currencyType){case"JPY":case"CNY":return`${c}${Math.round(r).toLocaleString()}`;case"INR":return`${c}${r.toLocaleString("en-IN")}`;default:return`${c}${r.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}}if(l.isDate&&r)try{return new Date(r.toString()).toLocaleDateString()}catch{return r}return(a.toLowerCase().includes("percent")||a.toLowerCase().includes("%"))&&typeof r=="number"?`${r.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}%`:typeof r=="number"?r.toLocaleString():r},Ne={SUM:"sum",COUNT:"count",AVG:"avg"},Ce=(r,a)=>{if(r.length===0)return"";switch(a){case Ne.SUM:return r.reduce((o,l)=>o+l,0);case Ne.COUNT:return r.length;case Ne.AVG:return(r.reduce((o,l)=>o+l,0)/r.length).toFixed(2);default:return""}};function vn(r,a,o,l){const{rowFields:c,columnFields:D,aggregation:R}=a,p=(o==null?void 0:o.filter(f=>f.isMetric).map(f=>f.field))||[],W=D.filter(f=>!p.includes(f));let y=D.filter(f=>p.includes(f));if(W.length===0){const f=D.filter(w=>p.includes(w)),A=[...c,...f],L=r.map(w=>[...c.map(I=>k(w[I],I,o)),...f.map(I=>k(w[I],I,o))]);return{headers:A,table:L}}const F=W[0];let C;if(y.length>0?C=y[0]:l&&p.includes(l)?C=l:C=p.find(f=>f!==F&&!c.includes(f)),!C){const f=[...c,F],A=r.map(L=>[...c.map(w=>k(L[w],w,o)),k(L[F],F,o)]);return{headers:f,table:A}}const q=Array.from(new Set(r.map(f=>f[F]))).map(String).sort();let m;y.length>0?(m=[...c],y.forEach(f=>{q.forEach(A=>{m.push(`${f} (${A})`)})})):m=[...c,...q];const G=new Map;r.forEach(f=>{const A=c.map(L=>String(f[L])).join("||");G.has(A)||G.set(A,[]),G.get(A).push(f)});const z=[];for(const[f,A]of Array.from(G.entries())){const L=f.split("||");if(y.length>0){const w=[...L];y.forEach(g=>{q.forEach(I=>{const O=A.filter(x=>String(x[F])===I);let P="";if(O.length>0){const x=O.map(X=>Number(X[g])||0);P=Ce(x,R)}w.push(k(P,g,o))})}),z.push(w)}else{const w=[...L];q.forEach(g=>{const I=A.filter(P=>String(P[F])===g);let O="";if(I.length>0){const P=I.map(x=>Number(x[C])||0);O=Ce(P,R)}w.push(k(O,C,o))}),z.push(w)}}return{headers:m,table:z}}function yn(r,a,o){const{rowFields:l,columnFields:c,aggregation:D}=a;if(l.length===0)return{rowFieldHeaderName:"",nonPivotedDimensionColumnNames:[],metricColumnNames:[],hierarchicalData:[]};const R=(o==null?void 0:o.filter(C=>C.isMetric).map(C=>C.field))||[],p=c.filter(C=>!R.includes(C)),W=c.filter(C=>R.includes(C));[l[0],...p,...W];const y=(C,q,m="root")=>{if(q>=l.length)return[];const G=l[q],z=new Map;C.forEach(w=>{const g=w[G];z.has(g)||z.set(g,[]),z.get(g).push(w)});const f=[];let A=0,L=[];if(p.length>0){const w=p[0];L=Array.from(new Set(r.map(g=>String(g[w])))).sort()}for(const[w,g]of Array.from(z.entries())){const I=`${m}_${G}_${String(w).replace(/\s+/g,"-")}_${A++}`,O={},P={},x={};R.forEach(i=>{var Q;if((Q=o==null?void 0:o.find(E=>E.field===i))==null?void 0:Q.isDate){const E=g.map(M=>M[i]?new Date(M[i].toString()):null).filter(M=>M&&!isNaN(M.getTime()));if(E.length>0){const M=new Date(Math.max(...E.map(H=>H?H.getTime():0)));O[i]=M.toISOString()}else O[i]="";if(P[i]={},p.length>0){const M=p[0];L.forEach(H=>{P[i][H]="-"}),L.forEach(H=>{const ee=g.filter(U=>String(U[M])===String(H)).map(U=>U[i]?new Date(U[i].toString()):null).filter(U=>U&&!isNaN(U.getTime()));if(ee.length>0){const U=new Date(Math.max(...ee.map(ie=>ie?ie.getTime():0)));P[i][H]=U.toISOString()}})}}else{const E=g.map(M=>Number(M[i])||0);if(O[i]=Ce(E,D),P[i]={},p.length>0){const M=p[0];L.forEach(H=>{P[i][H]=0}),L.forEach(H=>{const se=g.filter(ee=>String(ee[M])===String(H));if(se.length>0){const ee=se.map(U=>Number(U[i])||0);P[i][H]=Ce(ee,D)}})}}}),g.length>0&&p.forEach(i=>{x[i]=g[0][i]});const X=y(g,q+1,I);f.push({id:I,values:[],level:q+1,children:X,aggregates:O,pivotedAggregates:P,fieldName:G,fieldValue:w,dimensionValues:x})}return f.sort((w,g)=>String(w.fieldValue).localeCompare(String(g.fieldValue)))},F=y(r,0);return{rowFieldHeaderName:l[0],pivotDimensionInfo:p.length>0?{name:p[0],uniqueValues:Array.from(new Set(r.map(C=>String(C[p[0]])))).sort()}:void 0,nonPivotedDimensionColumnNames:p.slice(1),metricColumnNames:W,hierarchicalData:F}}const be=({data:r,headers:a=[],initialRowFields:o=[],initialColumnFields:l=[],config:c,defaultValueField:D="sales",pagination:R=!1,currentPage:p=1,totalPage:W=1,onPrevPage:y,onNextPage:F})=>{const C=Object.keys(r[0]||{}),q=a.filter(e=>!e.isMetric).map(e=>e.field),m=a.filter(e=>e.isMetric).map(e=>e.field),[G,z]=Y.useState({rowFields:o,columnFields:l.length>0?l:m,breadcrumbPath:[]}),[f,A]=Y.useState({openCard:null,view:o.length===0&&l.filter(e=>!m.includes(e)).length===0?ne.FLAT:ne.PIVOT,isAddDimensionsOpen:!0,isColSelected:l.some(e=>!m.includes(e)),hierarchyKey:0}),[L,w]=Y.useState({expandedRows:new Set,collapsedColumns:(()=>{const e=G.columnFields.find(s=>!m.includes(s));return e?new Set([e]):new Set})(),collapsedMetrics:new Set(m)}),g=Y.useRef({rowFields:G.rowFields,columnFields:G.columnFields}),I=Y.useRef(null),O=Y.useRef(null),P=e=>{z(s=>({...s,...e}))},x=e=>{A(s=>({...s,...e}))},X=e=>{w(s=>({...s,...e}))},{rowFields:i,columnFields:h}=G,{view:Q,openCard:E,isColSelected:M,isAddDimensionsOpen:H,hierarchyKey:se}=f,{expandedRows:ee,collapsedColumns:U,collapsedMetrics:ie}=L;Y.useEffect(()=>{function e(s){E!==null&&I.current&&!I.current.contains(s.target)&&O.current&&!O.current.contains(s.target)&&x({openCard:null})}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[E]);const me=q.length?q:C.filter(e=>{const s=r.slice(0,20);return s.filter(b=>typeof b[e]=="string").length>s.length/2});Array.from(new Set(me)),Y.useEffect(()=>{const e=h.some(b=>!m.includes(b));let s;i.length===0&&!e?s=ne.FLAT:i.length>0?s=ne.HIERARCHY:s=ne.PIVOT,Q!==s&&x({view:s}),(!ve(g.current.rowFields,i)||!ve(g.current.columnFields.filter(b=>!m.includes(b)),h.filter(b=>!m.includes(b))))&&X({expandedRows:new Set}),g.current={rowFields:[...i],columnFields:[...h]}},[i,h,m,Q]),Y.useEffect(()=>{i.length>0&&((g.current.rowFields.length!==i.length||!ve(g.current.rowFields,i))&&X({expandedRows:new Set}),JSON.stringify(g.current.rowFields)!==JSON.stringify(i)||JSON.stringify(g.current.columnFields)!==JSON.stringify(h)?x({hierarchyKey:Date.now()}):g.current.rowFields!==i&&x({hierarchyKey:se+1})),g.current={rowFields:[...i],columnFields:[...h]}},[i,h]);const ve=(e,s)=>{if(e.length!==s.length)return!1;for(let d=0;d<e.length;d++)if(e[d]!==s[d])return!1;return!0},De=(e,s)=>{if(e===s)return;const d=[...i],[b]=d.splice(e,1);d.splice(s,0,b),X({expandedRows:new Set}),x({hierarchyKey:se+1}),P({rowFields:d})},Be=e=>{var s,d;e&&typeof((s=e.source)==null?void 0:s.index)=="number"&&typeof((d=e.destination)==null?void 0:d.index)=="number"?De(e.source.index,e.destination.index):e&&typeof e.oldIndex=="number"&&typeof e.newRank=="number"?De(e.oldIndex,e.newRank):console.error("Invalid drag data format. Expected source/destination indices:",e)},{tableHeaders:Pe,tableData:qe,hierarchicalResult:je}=Y.useMemo(()=>{const e={rowFields:[...i],columnFields:[...h],aggregation:(c==null?void 0:c.aggregation)||"sum"},s=i.length===0,d=h.every(_=>m.includes(_)),b=h.some(_=>!m.includes(_));if(s&&b){const _=Array.from(new Set([...h])),N=r.map(Z=>_.map(J=>k(Z[J]??"",J,a)));return{tableHeaders:_,tableData:N,hierarchicalResult:void 0}}else if(Q===ne.FLAT||s&&d){const _=C,N=r.map(Z=>_.map(J=>k(Z[J]??"",J,a)));return{tableHeaders:_,tableData:N,hierarchicalResult:void 0}}else if(Q===ne.HIERARCHY&&i.length>0){const _=yn(r,e,a);return{tableHeaders:[],tableData:[],hierarchicalResult:_}}else{const{headers:_,table:N}=vn(r,e,a,D);return{tableHeaders:_,tableData:N,hierarchicalResult:void 0}}},[r,a,Q,JSON.stringify(i),JSON.stringify(h),m,D,C,ie,se,c==null?void 0:c.aggregation]),ye=(e,s)=>{var b;const d=(b=a.find(_=>_.field===e))==null?void 0:b.isMetric;if(s===ue.ROW){const _=i.includes(e)?i.filter(N=>N!==e):[...i,e];P({rowFields:_}),d||P({columnFields:h.filter(N=>N!==e)})}else if(s===ue.COL){x({isColSelected:!M});let _=[...h];if(d)_=h.includes(e)?h.filter(N=>N!==e):[...h,e];else if(h.includes(e))_=h.filter(N=>N!==e||m.includes(N));else{const N=h.filter(Z=>m.includes(Z));_=[e,...N]}P({columnFields:_}),d||P({rowFields:i.filter(N=>N!==e)})}},Oe=e=>{const s=new Set(ee);s.has(e)?s.delete(e):s.add(e),X({expandedRows:s})},Ge=e=>{const s=new Set(ie);s.has(e)?s.delete(e):s.add(e),X({collapsedMetrics:s})},We=(e,s,d,b,_)=>{const{pivotDimensionInfo:N,nonPivotedDimensionColumnNames:Z,metricColumnNames:J}=s,ge=b?t.jsx("div",{className:n.toggleControlWrapper,style:{paddingLeft:`${(d-1)*16}px`},children:t.jsx("div",{className:n.rowToggleControl,onClick:S=>{S.stopPropagation(),Oe(e.id)},children:t.jsx(xe,{icon:_?"chevron down":"chevron right",color:"black",style:{fontSize:"14px"}})})}):t.jsx("div",{className:n.toggleSpacerWrapper,style:{paddingLeft:`${(d-1)*16}px`},children:d>1&&t.jsx("span",{className:n.toggleIndentMarker})}),we=t.jsx("div",{className:n.fieldValueWithLevel,"data-level":d,"data-has-children":b?"true":"false",children:t.jsx("div",{className:`${n.fieldValueContent}${b?" "+n.hasChildren:""}`,"data-level":d,children:e.fieldValue})}),$=[ge,we];return Z.forEach(S=>{var ae;const te=((ae=e.dimensionValues)==null?void 0:ae[S])??"";$.push(t.jsx("div",{className:n.dimensionCell,children:k(te,S,a)}))}),N&&N.uniqueValues.length>0?J.forEach(S=>{if(ie.has(S)){const u=a.find(v=>v.field===S),T=u==null?void 0:u.isDate,V=N.uniqueValues;if(T){let v=null,j=!1;V.forEach(K=>{var le,pe;const B=(pe=(le=e.pivotedAggregates)==null?void 0:le[S])==null?void 0:pe[K];if(B&&B!=="-")try{const oe=new Date(B.toString());isNaN(oe.getTime())||(j=!0,(!v||oe>v)&&(v=oe))}catch{}}),$.push(t.jsx("div",{className:`${n.metricCell} ${n.collapsed}`,children:j&&v?k(v,S,a):"-"}))}else{let v=0;V.forEach(j=>{var B,le;const K=((le=(B=e.pivotedAggregates)==null?void 0:B[S])==null?void 0:le[j])??0;v+=Number(K)||0}),$.push(t.jsx("div",{className:`${n.metricCell} ${n.collapsed}`,children:k(v,S,a)}))}return}const te=a.find(u=>u.field===S),ae=te==null?void 0:te.isDate,re=N.uniqueValues;if(re.length>1)if(ae){let u=null,T=!1;re.forEach(V=>{var j,K;const v=(K=(j=e.pivotedAggregates)==null?void 0:j[S])==null?void 0:K[V];if(v&&v!=="-")try{const B=new Date(v.toString());isNaN(B.getTime())||(T=!0,(!u||B>u)&&(u=B))}catch{}}),$.push(t.jsx("div",{className:`${n.metricCell} ${n.totalCell}`,children:T&&u?k(u,S,a):"-"}))}else{let u=0;re.forEach(T=>{var v,j;const V=((j=(v=e.pivotedAggregates)==null?void 0:v[S])==null?void 0:j[T])??0;u+=Number(V)||0}),$.push(t.jsx("div",{className:`${n.metricCell} ${n.totalCell}`,children:k(u,S,a)}))}re.forEach(u=>{var V,v;const T=(v=(V=e.pivotedAggregates)==null?void 0:V[S])==null?void 0:v[u];if(ae)if(!T||T===""||T==="-")$.push(t.jsx("div",{className:n.metricCell,children:"-"}));else try{const j=new Date(T.toString());isNaN(j.getTime())?$.push(t.jsx("div",{className:n.metricCell,children:"-"})):$.push(t.jsx("div",{className:n.metricCell,children:k(T,S,a)}))}catch{$.push(t.jsx("div",{className:n.metricCell,children:"-"}))}else $.push(t.jsx("div",{className:n.metricCell,children:k(T??0,S,a)}))})}):J.forEach(S=>{const te=e.aggregates[S];$.push(t.jsx("div",{className:n.metricCell,children:k(te,S,a)}))}),$},Ue=(e,s)=>{if(e==="toggle")return t.jsx("div",{className:n.toggleColumnHeader});if(s){let b=n.headerDimension;return s==="Total"&&(b+=` ${n.totalHeader}`),t.jsx("div",{className:b,children:s})}const d=a.find(b=>b.field===e);if(d!=null&&d.isMetric){let b=n.metricHeader;return t.jsx("div",{className:b,children:e})}return t.jsx("div",{className:n.dimensionHeader,children:e})},Ze=e=>{if(!e||e.hierarchicalData.length===0)return null;const{rowFieldHeaderName:s,pivotDimensionInfo:d,nonPivotedDimensionColumnNames:b,metricColumnNames:_,hierarchicalData:N}=e,Z=["toggle",s];Z.push(...b);const J=d!==void 0,ge=J&&i.length>0;J?_.forEach(u=>{Z.push(u)}):Z.push(..._);const we=ge?_.map(u=>{if(ie.has(u))return{header:u,isCollapsed:!0,subColumns:[]};{const V=(d==null?void 0:d.uniqueValues)||[],v=V.length>1?["Total",...V]:V;return{header:u,isCollapsed:!1,subColumns:v.map(j=>String(j))}}}):[],$=(u,T=1,V=!0)=>{let v=[],j=[];return u.forEach(K=>{const B=ee.has(K.id);if(T===1||V){const pe=We(K,e,T,K.children.length>0,B);if(v.push(pe),j.push(T),B&&K.children.length>0){const oe=$(K.children,T+1,B);v=[...v,...oe.rows],j=[...j,...oe.levels]}}}),{rows:v,levels:j}},{rows:S,levels:te}=$(N),ae=(u,T)=>t.jsx("tr",{"data-row-level":te[T],children:u}),re=(u,T,V)=>V===0?typeof u=="object"&&u!==null&&Fe.isValidElement(u)?u:null:u;return t.jsxs("div",{className:n.ltPivotTableHierarchyContainer,children:[i.length>0&&t.jsx("div",{className:n.ltPivotTableBreadcrumb,children:i.map((u,T)=>t.jsxs(Fe.Fragment,{children:[T>0&&t.jsx("span",{className:n.breadcrumbSeparator,children:">"}),t.jsx("span",{className:n.breadcrumbItem,children:u})]},u))}),t.jsx(Ie,{headers:Z,cellData:S,size:"small",className:n.ltPivotTableTable,useCollapsibleColumns:ge,collapsibleColumns:we,onToggleCollapse:Ge,renderCustomHeader:Ue,renderCustomCell:re,renderCustomRow:ae,pagination:R,currentPage:p,totalPage:W,onPrevPage:y,onNextPage:F,headerClasses:{0:n.toggleColumnHeader,1:`${n.dimensionHeader} ${n.primaryDimension}`},columnClasses:{0:n.toggleColumn}})]})},Ke=i.length>0?de.DRAG:de.NONESTING,Ye=()=>{i.length>0&&(P({rowFields:[]}),X({expandedRows:new Set}),x({hierarchyKey:f.hierarchyKey+1}))};return t.jsxs("div",{className:n.ltPivotTable,children:[t.jsxs("div",{className:n.ltPivotTableControls,children:[t.jsxs("div",{className:n.ltPivotTableButtonContainer,ref:O,children:[t.jsx(ce,{label:`Row Nesting${i.length>0?` (${i.length})`:""}`,onClick:()=>{E==="row"?x({openCard:null}):E!==null?(x({openCard:null}),setTimeout(()=>x({openCard:"row"}),10)):x({openCard:"row"})},primary:E==="row",className:n.pivotButton}),t.jsx(ce,{label:`Column Nesting${h.some(e=>!m.includes(e))?` (${h.find(e=>!m.includes(e))||""})`:""}`,onClick:()=>{E==="col"?x({openCard:null}):E!==null?(x({openCard:null}),setTimeout(()=>x({openCard:"col"}),10)):x({openCard:"col"})},primary:E==="col",className:`${n.pivotButton}${E==="col"?" "+n.pivotButtonActive:""}`})]}),E==="row"&&t.jsx("div",{ref:I,children:t.jsxs(Ee,{className:n.pivotTableCard,header:"Row Hierarchy",children:[t.jsx("div",{className:n.pivotToggleContainer,children:t.jsxs("div",{className:n.flatButtonContainer,children:[t.jsx("p",{className:n.flat,children:"Flat View"}),t.jsx(it,{checkedColor:"green",className:n.pivotTableToggle,onChange:Ye,uncheckedColor:"lightgray",checked:i.length===0})]})}),t.jsx("div",{className:n.pivotExtraCard,children:t.jsxs("div",{className:n.ltPivotTableFieldSelection,children:[t.jsx(Se,{dataList:i.map(e=>({key:e,value:e,selectedValues:[]})),dataSchema:{parentId:"key",parentName:"value",childrenElement:"childrens",childName:"value",childId:"key"},identifier:"row-fields",onDragEnd:Be,parentItemElem:e=>t.jsx(xe,{icon:"close",size:"small",color:"black",className:n.draggableIcon,onClick:()=>{ye(e.parentName,ue.ROW)}}),childrenItemElem:()=>t.jsx(t.Fragment,{}),selectParent:()=>{},selectChild:()=>{}}),t.jsx("p",{className:n.addDimensionMessage,children:"Add Dimension"}),t.jsx("p",{className:n.rowString,children:Ke}),t.jsxs("div",{className:n.pivotTableAddDimensionsDraggableContainer,children:[!H&&t.jsx("div",{className:n.addDimensionsMessage,children:"Click on add dimensions"}),H&&t.jsx(t.Fragment,{children:me.filter(e=>!i.includes(e)).length>0?me.filter(e=>!i.includes(e)).map(e=>t.jsx(ce,{label:e,onClick:()=>ye(e,ue.ROW),disabled:h.includes(e)&&!m.includes(e),className:n.addDimensionsButton},`available-${e}`)):t.jsx("div",{className:n.noDimensionsMessage,children:de.ND})})]})]})})]})}),E==="col"&&t.jsx("div",{ref:I,children:t.jsx(Ee,{className:n.pivotTableCard,header:"Column Nesting",children:t.jsx("div",{className:n.pivotExtraCard,children:h.some(e=>!m.includes(e))?t.jsxs("div",{className:n.selectedColumnContainer,children:[t.jsx("p",{children:de.CND}),t.jsx("div",{className:n.selectedNestingColumn,children:t.jsxs("div",{className:n.selectedNestingColumn,children:[t.jsx(ce,{label:h.find(e=>!m.includes(e))||"",className:n.pivotButtonSelectedDimension,onClick:()=>{}}),t.jsx(xe,{icon:"close",size:"small",color:"black",className:n.removeColumnIcon,onClick:()=>{const e=h.find(s=>!m.includes(s));e&&(P({columnFields:h.filter(s=>s!==e||m.includes(s))}),x({isColSelected:!1}))}})]})})]}):t.jsxs(t.Fragment,{children:[t.jsx("p",{children:de.NCND}),t.jsx("div",{className:n.ltPivotTableFieldSelection,children:me.map(e=>m.includes(e)?null:t.jsx(ce,{label:e,onClick:()=>ye(e,ue.COL),disabled:i.includes(e),className:n.allColumnDimensionButton},e))})]})})})})]}),t.jsx("div",{className:n.ltPivotTable__content,children:Q===ne.HIERARCHY&&je?Ze(je):t.jsx(Ie,{headers:Pe,cellData:qe,sortableColumns:Pe.map(e=>{const s=a.find(d=>d.field===e);return(s==null?void 0:s.isSortable)===!0}),onSort:function(){},pagination:R,currentPage:p,totalPage:W,onPrevPage:y,onNextPage:F,showDownload:!0,size:"small",renderCustomHeader:e=>{if(!e.includes(" ("))return e;const[s,d]=e.split(" (");return t.jsxs("div",{className:n.combinedHeader,children:[t.jsx("div",{className:n.headerMetric,children:s}),t.jsx("div",{className:n.headerDimension,children:d.slice(0,-1)})]})},renderCustomCell:(e,s,d)=>{}})})]})};be.__docgenInfo={description:"",methods:[],displayName:"LtPivotTable",props:{data:{required:!0,tsType:{name:"Array",elements:[{name:"Record",elements:[{name:"string"},{name:"union",raw:"string | number",elements:[{name:"string"},{name:"number"}]}],raw:"Record<string, string | number>"}],raw:"Record<string, string | number>[]"},description:""},headers:{required:!1,tsType:{name:"Array",elements:[{name:"HeaderProperties"}],raw:"HeaderProperties[]"},description:"",defaultValue:{value:"[]",computed:!1}},initialRowFields:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:"",defaultValue:{value:"[]",computed:!1}},initialColumnFields:{required:!1,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:"",defaultValue:{value:"[]",computed:!1}},config:{required:!1,tsType:{name:"PivotConfig"},description:""},defaultValueField:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'sales'",computed:!1}},pagination:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},currentPage:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"1",computed:!1}},totalPage:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"1",computed:!1}},onPrevPage:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onNextPage:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const rs={title:"Components/LtPivotTable",component:be,tags:["autodocs"]},wn=[["P001","Product A",120,"Electronics","2025-01-01",2.5,1.2,1500,"2025-01-01T10:30:00Z"],["P002","Product B",150,"Clothing","2025-01-02",1.1,.8,700,"2025-01-02T14:20:00Z"],["P001","Product A",180,"Electronics","2025-01-10",3.2,2,2200,"2025-01-09T08:00:00Z"],["P003","Product C",200,"Electronics","2025-02-10",.9,.6,500,"2025-02-08T11:45:00Z"],["P002","Product B",160,"Clothing","2025-02-15",1.5,1.1,850,"2025-02-13T16:10:00Z"],["P004","Product D",250,"Furniture","2025-03-15",4,3.5,3200,"2025-03-14T09:00:00Z"],["P005","Product E",300,"Clothing","2025-03-18",.5,.3,200,"2025-03-17T13:30:00Z"],["P003","Product C",220,"Electronics","2025-03-25",2.1,1.8,1800,"2025-03-23T12:00:00Z"],["P006","Product F",120,"Electronics","2025-04-05",1.8,1,1100,"2025-04-04T07:40:00Z"],["P007","Product G",180,"Furniture","2025-04-07",3.5,2.7,2500,"2025-04-06T10:20:00Z"],["P001","Product A",160,"Electronics","2025-04-15",1.7,.9,1300,"2025-04-13T15:10:00Z"],["P002","Product B",140,"Clothing","2025-04-18",2.2,1.6,1e3,"2025-04-17T08:55:00Z"],["P004","Product D",260,"Furniture","2025-04-20",3,2.1,2900,"2025-04-19T11:00:00Z"]],Te=[{field:"Product ID",key:"Product ID"},{field:"Product Name",key:"Product Name"},{field:"Sales",key:"Sales",isCurrency:!0,currencyType:"INR",isMetric:!0,isSortable:!0},{field:"Category",key:"Category",isMetric:!1},{field:"Date",key:"Date",isDate:!0,isMetric:!1},{field:"Downtime%",key:"downtime",isMetric:!0},{field:"Downtime hours",key:"downtimeHours",isMetric:!0},{field:"Revenue Impact",key:"RevenueImpact",isCurrency:!0,isMetric:!0},{field:"Last Downtime",key:"LastdownTime",isDate:!0,isMetric:!0}],He=wn.map(r=>Object.fromEntries(Te.map((a,o)=>[a.field,r[o]]))),$e={width:"100%",maxWidth:"100%",overflowX:"auto",padding:"20px 0"},he={render:r=>t.jsx("div",{style:$e,children:t.jsx(be,{...r})}),args:{data:He,headers:Te,pagination:!0,currentPage:1,totalPage:3,onPrevPage:()=>console.log("Previous page clicked"),onNextPage:()=>console.log("Next page clicked"),config:{rowFields:["Category","Product Name"],columnFields:["Sales"],aggregation:"sum"}}},_e={render:function(){const[a,o]=Y.useState(1),l=3,c=()=>{a>1&&o(a-1)},D=()=>{a<l&&o(a+1)};return t.jsx("div",{style:$e,children:t.jsx(be,{data:He,headers:Te,pagination:!0,currentPage:a,totalPage:l,onPrevPage:c,onNextPage:D,config:{rowFields:["Category","Product Name"],columnFields:["Sales"],aggregation:"sum"}})})}};var Re,Le,Ve;he.parameters={...he.parameters,docs:{...(Re=he.parameters)==null?void 0:Re.docs,source:{originalSource:`{
  render: args => <div style={storyWrapper}>
      <LtPivotTable {...args} />
    </div>,
  args: {
    data: transformedData,
    headers,
    // Updated headers
    pagination: true,
    // Enable pagination
    currentPage: 1,
    // Set initial page
    totalPage: 3,
    // Set total pages
    onPrevPage: () => console.log('Previous page clicked'),
    onNextPage: () => console.log('Next page clicked'),
    config: {
      rowFields: ['Category', 'Product Name'],
      //required for row field
      columnFields: ['Sales'],
      //required for column field
      aggregation: 'sum' //required for total field calculation
    }
  }
}`,...(Ve=(Le=he.parameters)==null?void 0:Le.docs)==null?void 0:Ve.source}}};var Ae,ke,Me;_e.parameters={..._e.parameters,docs:{...(Ae=_e.parameters)==null?void 0:Ae.docs,source:{originalSource:`{
  render: function Render() {
    // Set up state for pagination
    const [currentPage, setCurrentPage] = useState(1);
    const totalPages = 3;

    // Handlers for pagination
    const handlePrevPage = () => {
      if (currentPage > 1) {
        setCurrentPage(currentPage - 1);
      }
    };
    const handleNextPage = () => {
      if (currentPage < totalPages) {
        setCurrentPage(currentPage + 1);
      }
    };
    return <div style={storyWrapper}>
        <LtPivotTable data={transformedData} headers={headers} pagination={true} currentPage={currentPage} totalPage={totalPages} onPrevPage={handlePrevPage} onNextPage={handleNextPage} config={{
        rowFields: ['Category', 'Product Name'],
        columnFields: ['Sales'],
        aggregation: 'sum'
      }} />
      </div>;
  }
}`,...(Me=(ke=_e.parameters)==null?void 0:ke.docs)==null?void 0:Me.source}}};const ls=["Default","WithInteractivePagination"];export{he as Default,_e as WithInteractivePagination,ls as __namedExportsOrder,rs as default};
